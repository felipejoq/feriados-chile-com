---
import { actions } from "astro:actions";
import { getTodayDateChile, longDate } from "../../utils/dates/date";

const { data, error } = await Astro.callAction(
  actions.TodayIsHoliday,
  getTodayDateChile(),
);

if (error) {
  console.log(error);
  throw new Error(error.message);
}

const { isHoliday, message, holidays } = data;
---

<div>
  {
    isHoliday ? (
      <div class="flex flex-col gap-4">
        <div class="flex items-start gap-3">
          <span class="text-3xl">âœ¨</span>
          <div>
            <p class="text-emerald-700 font-bold text-lg leading-tight">
              {message}
            </p>
            <p class="text-emerald-600 text-sm mt-1">
              {longDate(holidays[0].date)}
            </p>
          </div>
        </div>
        <ul class="flex flex-col gap-2">
          {holidays.map((holiday, index) => (
            <li 
              class={`group transition-all duration-300 ${holiday.slug ? 'cursor-pointer' : ''}`}
              style={{
                animation: `slideIn 0.4s ease-out ${index * 0.1}s backwards`
              }}
            >
              {holiday.slug ? (
                <a
                  href={holiday.slug}
                  class="
                    px-4 py-3 rounded-lg font-semibold
                    bg-gradient-to-r from-emerald-500 to-teal-500
                    text-white shadow-md
                    hover:shadow-lg hover:scale-105 hover:from-emerald-600 hover:to-teal-600
                    transition-all duration-200 block flex items-center gap-2
                  "
                >
                  {holiday.icon && <span class="text-xl">{holiday.icon}</span>}
                  {holiday.description}
                </a>
              ) : (
                <span class="
                  px-4 py-3 rounded-lg font-semibold
                  bg-gradient-to-r from-emerald-500 to-teal-500
                  text-white shadow-md
                  block flex items-center gap-2
                ">
                  {holiday.icon && <span class="text-xl">{holiday.icon}</span>}
                  {holiday.description}
                </span>
              )}
            </li>
          ))}
        </ul>
      </div>
    ) : (
      <div class="flex items-start gap-3">
        <span class="text-3xl">ðŸŒ…</span>
        <div>
          <p class="text-amber-700 font-semibold text-lg">
            {message}
          </p>
          <p class="text-amber-600 text-sm mt-1">
            {longDate()}
          </p>
        </div>
      </div>
    )
  }
</div>

<style>
  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateX(-10px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
</style>
