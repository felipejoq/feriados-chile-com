---
import { actions } from "astro:actions";
import { longDate, getTodayDateChile, getDaysUntilHoliday } from "../../utils/dates/date";

const { data, error } = await Astro.callAction(
  actions.NextHoliday,
  getTodayDateChile(),
);

if (error) {
  console.log(error);
  throw new Error(error.message);
}

const { hasNextHoliday, nextHoliday, message } = data;
const daysRemaining = hasNextHoliday && nextHoliday && nextHoliday.date ? getDaysUntilHoliday(nextHoliday.date) : 0;
---

<>
  {
    hasNextHoliday && nextHoliday ? (
      <div class="flex items-start gap-3 sm:gap-4 animate-in fade-in duration-500">
        <div class="flex-shrink-0 flex flex-col items-center w-14 sm:w-16 mt-0.5">
          <div class="w-full bg-amber-500 text-white text-[10px] font-bold text-center py-0.5 rounded-t-md uppercase">
            Faltan
          </div>
          <div class="w-full bg-white border-2 border-amber-200 rounded-b-md p-2 flex items-center justify-center">
            <span class="text-2xl sm:text-3xl font-bold text-amber-700">{daysRemaining}</span>
          </div>
          <span class="text-[10px] text-amber-600 mt-0.5">{daysRemaining === 1 ? 'd√≠a' : 'd√≠as'}</span>
        </div>
        <div class="flex-1 min-w-0">
          <p class="text-amber-700 font-bold text-base sm:text-lg leading-tight">
            {nextHoliday.icon ? `${nextHoliday.icon} ${nextHoliday.description}` : nextHoliday.description}
          </p>
          <p class="text-amber-600 text-xs sm:text-sm mt-1 flex items-center gap-1.5">
            <span>üìç</span>
            <span class="truncate">{longDate(nextHoliday?.date)}</span>
          </p>
        </div>
        <span class="flex-shrink-0 bg-amber-50 text-amber-600 text-[10px] font-medium px-2 py-1 rounded-full uppercase tracking-wide">
          Pr√≥ximo
        </span>
      </div>
    ) : (
      <div class="flex items-start gap-3 text-amber-700">
        <span class="text-3xl">üåü</span>
        <p class="font-semibold">{message}</p>
      </div>
    )
  }
</>

<style>
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(5px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  :global(.animate-in) {
    animation: fadeIn 0.5s ease-out;
  }
</style>