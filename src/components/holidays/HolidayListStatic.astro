---
import {getCollection} from "astro:content";
import {sortHolidays} from "../../utils/dates/date.ts";
import type {Holiday} from "../../interfaces/holidays/holiday.ts";
import HolidayCard from "./HolidayCard.astro";
import HolidaySchema from "./HolidaySchema.astro";

const holidaysCollection = await getCollection("holidays_2026");

const holidays = holidaysCollection
  .map(holidayItem => ({
    id: holidayItem.id,
    ...holidayItem.data
  }))
  .filter(h => h.date) // Filtrar feriados sin fecha
  .sort(sortHolidays) as Array<Holiday & { id: string }>;
---

<div class="flex flex-col w-full my-6 gap-4" id="holiday-list">
  {
    holidays.map((holiday) => (
      <HolidayCard holiday={holiday} />
    ))
  }
  <p id="no-results-message" class="text-center text-gray-500 hidden">No hay feriados para mostrar.</p>
</div>

<!-- JSON-LD Schemas para feriados -->
{holidays.map((holiday) => (
  <HolidaySchema holiday={holiday} />
))}

<script>
  import type { FilterState } from "../../utils/holidays/holidayFilter.ts";
  import { setupFilterListeners, filterCards } from "../../utils/holidays/holidayFilter.ts";

  const filterState: FilterState = {
    activeTypeFilter: null,
    activeMonthFilter: null,
    activeSearchQuery: '',
  };

  function initializeFilterListeners() {
    setupFilterListeners(filterState);
  }

  // Usar astro:page-load para que funcione en navegaciones
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeFilterListeners);
  } else {
    initializeFilterListeners();
  }

  // Tambi√©n escuchar astro:page-load para view transitions
  document.addEventListener('astro:page-load', initializeFilterListeners);
</script>
