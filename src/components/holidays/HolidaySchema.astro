---
import type { Holiday } from "../../interfaces/holidays/holiday.ts";
import { SITE_IMAGE } from "../../utils/config/globals.ts";

interface Props {
  holiday: Holiday & { id: string };
}

const { holiday } = Astro.props;

let imageUrl: string | undefined;

if (holiday.article && typeof holiday.article === 'object' && 'data' in holiday.article) {
  const articleImage = (holiday.article as any).data?.image;
  if (articleImage) {
    imageUrl = articleImage.startsWith('http') 
      ? articleImage 
      : `https://feriados-chile.com${articleImage}`;
  }
}

imageUrl = imageUrl || (SITE_IMAGE.src ? `https://feriados-chile.com${SITE_IMAGE.src}` : undefined);

const schema = {
  "@context": "https://schema.org",
  "@type": "Event",
  "name": holiday.description || "Feriado",
  "startDate": holiday.date || "",
  "endDate": holiday.date || "",
  "description": `${holiday.description} - Tipo: ${holiday.type}. Respaldo legal: ${holiday.legalSupport}`,
  "eventStatus": "https://schema.org/EventScheduled",
  "url": holiday.slug ? `https://feriados-chile.com/${holiday.slug}` : "https://feriados-chile.com",
  "image": imageUrl,
  "location": {
    "@type": "Place",
    "name": "Chile",
    "address": {
      "@type": "PostalAddress",
      "addressCountry": "CL"
    }
  },
  "organizer": {
    "@type": "Organization",
    "name": "Gobierno de Chile",
    "url": "https://www.gob.cl"
  },
  "offers": {
    "@type": "Offer",
    "url": holiday.slug ? `https://feriados-chile.com/${holiday.slug}` : "https://feriados-chile.com",
    "price": "0",
    "priceCurrency": "CLP",
    "availability": "https://schema.org/PreOrder"
  }
};

// Filtrar valores undefined
const cleanSchema = JSON.parse(JSON.stringify(schema));
---

<script type="application/ld+json" set:html={JSON.stringify(cleanSchema)}></script>
